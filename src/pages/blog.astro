---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";

const allBlogEntries = await getCollection("blog");
const publishedBlogEntries = allBlogEntries.filter((entry) => !entry.data.draft && entry.data.publishDate < new Date());
publishedBlogEntries.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
const hasEntries = publishedBlogEntries.length > 0;
---

<Layout title="最新情報・ニュース - Schindler-JP">
  <Container>
    <section class="py-10 text-center">
      <h1 class="text-4xl md:text-5xl font-bold">最新情報・ニュース</h1>
      <p class="mt-4 text-lg text-slate-600">AI技術の最新動向・お知らせ・イベント・事例等、企業の重要ニュースをお届けします</p>
    </section>
    <main class="mt-5">
      <ul class="grid md:grid-cols-2 lg:grid-cols-3 gap-10 max-w-6xl mx-auto">
        {hasEntries && publishedBlogEntries.map((blogPostEntry) => (
          <li class="bg-white rounded-xl shadow p-6 flex flex-col justify-between h-full">
            <a href={`/blog/${blogPostEntry.slug}`} class="block hover:opacity-80 transition">
              <div class="flex gap-2 items-center text-slate-400 text-xs mb-2">
                <span>{blogPostEntry.data.category}</span>
                <span>•</span>
                <time datetime={blogPostEntry.data.publishDate.toISOString()}>{blogPostEntry.data.publishDate.toLocaleDateString()}</time>
              </div>
              <h2 class="text-lg font-semibold mb-1 text-gray-800">{blogPostEntry.data.title}</h2>
              <p class="text-slate-500 mb-2 text-sm line-clamp-3">{blogPostEntry.data.excerpt || "最新のAI事例や企業動向を分かりやすくご紹介。"}</p>
              <div class="flex items-center gap-2 mt-auto text-xs text-slate-500">
                <span>{blogPostEntry.data.author}</span>
              </div>
            </a>
          </li>
        ))}
      </ul>
      {!hasEntries && (
        <div class="text-center text-slate-500 my-8 col-span-3">まだ記事がありません。</div>
      )}
    </main>
  </Container>
</Layout>
